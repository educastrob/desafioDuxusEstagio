<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lises de Times</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .analysis-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .analysis-card:hover {
            transform: translateY(-2px);
        }
        .result-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üèÜ Sistema de Escala√ß√£o</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/integrante">Cadastrar Integrantes</a>
                <a class="nav-link" href="/time">Montar Times</a>
                <a class="nav-link active" href="/analises">An√°lises</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4"><i class="fas fa-chart-bar"></i> An√°lises de Times</h2>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-calendar"></i> Filtros de Data (Opcional)</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="dataInicial" class="form-label">Data Inicial</label>
                                <input type="date" class="form-control" id="dataInicial">
                            </div>
                            <div class="col-md-6">
                                <label for="dataFinal" class="form-label">Data Final</label>
                                <input type="date" class="form-control" id="dataFinal">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card analysis-card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-users"></i> Integrante Mais Usado</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Descobre qual integrante foi mais utilizado nos times</p>
                                <button class="btn btn-primary" onclick="analisarIntegranteMaisUsado()">
                                    <i class="fas fa-search"></i> Analisar
                                </button>
                                <div id="resultIntegranteMaisUsado" class="result-box d-none"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card analysis-card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-trophy"></i> Time Mais Comum</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Identifica a composi√ß√£o de time mais frequente</p>
                                <button class="btn btn-success" onclick="analisarTimeMaisComum()">
                                    <i class="fas fa-search"></i> Analisar
                                </button>
                                <div id="resultTimeMaisComum" class="result-box d-none"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card analysis-card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-tag"></i> Fun√ß√£o Mais Comum</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Descobre qual fun√ß√£o √© mais utilizada</p>
                                <button class="btn btn-info" onclick="analisarFuncaoMaisComum()">
                                    <i class="fas fa-search"></i> Analisar
                                </button>
                                <div id="resultFuncaoMaisComum" class="result-box d-none"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card analysis-card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-gamepad"></i> Franquia Mais Famosa</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Identifica a franquia mais popular</p>
                                <button class="btn btn-warning" onclick="analisarFranquiaMaisFamosa()">
                                    <i class="fas fa-search"></i> Analisar
                                </button>
                                <div id="resultFranquiaMaisFamosa" class="result-box d-none"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card analysis-card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie"></i> Contagem por Franquia</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Mostra quantos integrantes por franquia</p>
                                <button class="btn btn-secondary" onclick="analisarContagemPorFranquia()">
                                    <i class="fas fa-search"></i> Analisar
                                </button>
                                <div id="resultContagemPorFranquia" class="result-box d-none"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card analysis-card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar"></i> Contagem por Fun√ß√£o</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Mostra quantos integrantes por fun√ß√£o</p>
                                <button class="btn btn-dark" onclick="analisarContagemPorFuncao()">
                                    <i class="fas fa-search"></i> Analisar
                                </button>
                                <div id="resultContagemPorFuncao" class="result-box d-none"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-calendar-day"></i> Time de uma Data Espec√≠fica</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="dataEspecifica" class="form-label">Data</label>
                                        <input type="date" class="form-control" id="dataEspecifica" value="2024-01-01">
                                    </div>
                                    <div class="col-md-6 d-flex align-items-end">
                                        <button class="btn btn-primary" onclick="analisarTimeDaData()">
                                            <i class="fas fa-search"></i> Buscar Time
                                        </button>
                                    </div>
                                </div>
                                <div id="resultTimeDaData" class="result-box d-none mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function getParametrosData() {
            const dataInicial = document.getElementById('dataInicial').value;
            const dataFinal = document.getElementById('dataFinal').value;
            
            let params = '';
            if (dataInicial) params += `dataInicial=${dataInicial}`;
            if (dataFinal) {
                if (params) params += '&';
                params += `dataFinal=${dataFinal}`;
            }
            return params;
        }

        function mostrarResultado(elementId, resultado, tipo = 'success') {
            const element = document.getElementById(elementId);
            element.classList.remove('d-none');
            
            if (tipo === 'error') {
                element.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-triangle"></i> ${resultado}</div>`;
            } else if (tipo === 'empty') {
                element.innerHTML = `<div class="alert alert-warning"><i class="fas fa-info-circle"></i> ${resultado}</div>`;
            } else {
                element.innerHTML = `<div class="alert alert-success"><i class="fas fa-check-circle"></i> ${resultado}</div>`;
            }
        }

        function analisarIntegranteMaisUsado() {
            const params = getParametrosData();
            const url = `/api/integrante_mais_usado${params ? '?' + params : ''}`;

            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    const resultado = `Integrante mais usado: <strong>${data.nome}</strong> (${data.franquia} - ${data.funcao})`;
                    mostrarResultado('resultIntegranteMaisUsado', resultado);
                } else {
                    mostrarResultado('resultIntegranteMaisUsado', 'Nenhum integrante encontrado', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultIntegranteMaisUsado', 'Erro ao analisar integrante mais usado', 'error');
            });
        }

        function analisarTimeMaisComum() {
            const params = getParametrosData();
            const url = `/api/time_mais_comum${params ? '?' + params : ''}`;

            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.integrantes && data.integrantes.length > 0) {
                    const resultado = `Time mais comum: <strong>${data.integrantes.join(', ')}</strong>`;
                    mostrarResultado('resultTimeMaisComum', resultado);
                } else {
                    mostrarResultado('resultTimeMaisComum', 'Nenhum time encontrado', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultTimeMaisComum', 'Erro ao analisar time mais comum', 'error');
            });
        }

        function analisarFuncaoMaisComum() {
            const params = getParametrosData();
            const url = `/api/funcao_mais_comum${params ? '?' + params : ''}`;

            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.Fun√ß√£o) {
                    const resultado = `Fun√ß√£o mais comum: <strong>${data.Fun√ß√£o}</strong>`;
                    mostrarResultado('resultFuncaoMaisComum', resultado);
                } else {
                    mostrarResultado('resultFuncaoMaisComum', 'Nenhuma fun√ß√£o encontrada', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultFuncaoMaisComum', 'Erro ao analisar fun√ß√£o mais comum', 'error');
            });
        }

        function analisarFranquiaMaisFamosa() {
            const params = getParametrosData();
            const url = `/api/franquia_mais_famosa${params ? '?' + params : ''}`;

            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.franquia) {
                    const resultado = `Franquia mais famosa: <strong>${data.franquia}</strong>`;
                    mostrarResultado('resultFranquiaMaisFamosa', resultado);
                } else {
                    mostrarResultado('resultFranquiaMaisFamosa', 'Nenhuma franquia encontrada', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultFranquiaMaisFamosa', 'Erro ao analisar franquia mais famosa', 'error');
            });
        }

        function analisarContagemPorFranquia() {
            const params = getParametrosData();
            const url = `/api/contagem_por_franquia${params ? '?' + params : ''}`;

            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (Object.keys(data).length > 0) {
                    const resultado = Object.entries(data)
                        .map(([franquia, count]) => `<strong>${franquia}</strong>: ${count}`)
                        .join(', ');
                    mostrarResultado('resultContagemPorFranquia', `Contagem por franquia: ${resultado}`);
                } else {
                    mostrarResultado('resultContagemPorFranquia', 'Nenhuma franquia encontrada', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultContagemPorFranquia', 'Erro ao analisar contagem por franquia', 'error');
            });
        }

        function analisarContagemPorFuncao() {
            const params = getParametrosData();
            const url = `/api/contagem_por_funcao${params ? '?' + params : ''}`;

            fetch(url)
            .then(response => response.json())
            .then(data => {
                if (Object.keys(data).length > 0) {
                    const resultado = Object.entries(data)
                        .map(([funcao, count]) => `<strong>${funcao}</strong>: ${count}`)
                        .join(', ');
                    mostrarResultado('resultContagemPorFuncao', `Contagem por fun√ß√£o: ${resultado}`);
                } else {
                    mostrarResultado('resultContagemPorFuncao', 'Nenhuma fun√ß√£o encontrada', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultContagemPorFuncao', 'Erro ao analisar contagem por fun√ß√£o', 'error');
            });
        }

        function analisarTimeDaData() {
            const data = document.getElementById('dataEspecifica').value;
            if (!data) {
                alert('Por favor, selecione uma data');
                return;
            }
            
            fetch(`/api/time_da_data?data=${data}`)
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Time n√£o encontrado para esta data');
                }
            })
            .then(data => {
                if (data.integrantes && data.integrantes.length > 0) {
                    const resultado = `Time de ${data.data}: <strong>${data.integrantes.join(', ')}</strong>`;
                    mostrarResultado('resultTimeDaData', resultado);
                } else {
                    mostrarResultado('resultTimeDaData', 'Nenhum time encontrado para esta data', 'empty');
                }
            })
            .catch(error => {
                mostrarResultado('resultTimeDaData', error.message, 'error');
            });
        }
    </script>
</body>
</html>
